<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rate Limiting &mdash; Intel® QuickAssist Technology  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/qat.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Power Management" href="infrastructure_power_management.html" />
    <link rel="prev" title="Telemetry" href="infrastructure_device_telemetry.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Intel® QuickAssist Technology
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../qat_general/legal.html">Legal Notices &amp; Disclaimers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Intro/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Intro/terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RN/In-Tree/index.html">Release Notes - In-Tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RN/Linux/2.X/index.html">Release Notes - Linux*</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RN/VMware/2.X/index.html">Release Notes - VMware*</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GSG/2.X/index.html">Getting Started Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Programmer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">About this Document</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="infrastructure_index.html">Infrastructure</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="infrastructure_queue_pairs.html">Queues and Queue Pairs</a></li>
<li class="toctree-l3"><a class="reference internal" href="infrastructure_service_instances.html">Service Instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="infrastructure_memory_management.html">Memory Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="infrastructure_modes_of_operation.html">Modes of Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="infrastructure_load_balancing.html">Load Balancing</a></li>
<li class="toctree-l3"><a class="reference internal" href="infrastructure_debugability.html">Debugability</a></li>
<li class="toctree-l3"><a class="reference internal" href="infrastructure_heartbeat.html">Heartbeat</a></li>
<li class="toctree-l3"><a class="reference internal" href="infrastructure_device_telemetry.html">Telemetry</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Rate Limiting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#rate-limiting-overview">Rate Limiting Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#out-of-tree-rate-limiting">Out-of-Tree Rate Limiting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#in-tree-rate-limiting">In-tree Rate Limiting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="infrastructure_power_management.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="infrastructure_ras.html">Reliability, Availability, and Stability (RAS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="acceleration_driver.html">Acceleration Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration_files_index.html">Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="services_index.html">Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="apis_index.html">Supported APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtualization.html">Virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Secure Architecture Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="revision_history.html">Revision History</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../VIRT/index.html">Virtualization Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PERF/index.html">Performance Optimization Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qatlib/index.html">QATlib User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AppNotes/index.html">Application Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API_PG/index.html">API Programmer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qat_general/contact.html">Contact &amp; Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qat_general/collateral_list.html">Documentation &amp; Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Intel® QuickAssist Technology</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Programmer’s Guide</a></li>
          <li class="breadcrumb-item"><a href="infrastructure_index.html">Infrastructure</a></li>
      <li class="breadcrumb-item active">Rate Limiting</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rate-limiting">
<span id="qat-2-0-pg-infrastructure-rate-limiting"></span><h1>Rate Limiting<a class="headerlink" href="#rate-limiting" title="Permalink to this heading"></a></h1>
<section id="rate-limiting-overview">
<h2>Rate Limiting Overview<a class="headerlink" href="#rate-limiting-overview" title="Permalink to this heading"></a></h2>
<p>Rate Limiting is implemented by monitoring the utilization of the device on a per-VF, per-service basis and comparing that to the SLA allocated to that VF and service. This ensures that resources are allocated according to predefined agreements, preventing any single VF from monopolizing device capacity.</p>
<p>Rate Limiting is set up on the host system, allowing administrators to manage and allocate resources effectively. It can be configured for each Physical Function (PF) on the device, providing granular control over resource distribution across different services and virtual functions.</p>
<p>Resources are shared across guests, and the resource utilization of each guest is measured relative to the capacity of the physical function. The feature is supported for SYM, ASYM, and DC services.</p>
<p>This document provides instructions for enabling Rate Limiting for both Out-of-Tree (OOT) and In-tree stacks.</p>
</section>
<section id="out-of-tree-rate-limiting">
<h2>Out-of-Tree Rate Limiting<a class="headerlink" href="#out-of-tree-rate-limiting" title="Permalink to this heading"></a></h2>
<section id="enabling-rate-limiting">
<h3>Enabling Rate Limiting<a class="headerlink" href="#enabling-rate-limiting" title="Permalink to this heading"></a></h3>
<p>To enable the Rate Limiting feature for the Out-of-Tree stack:</p>
<ol class="arabic simple">
<li><p><strong>Install</strong> the driver package on the host with Single-Root Input/Output Virtualization (SR-IOV) enabled.</p></li>
<li><p><strong>Set</strong> <code class="docutils literal notranslate"><span class="pre">ServicesEnabled</span></code> to <code class="docutils literal notranslate"><span class="pre">asym</span></code> or <code class="docutils literal notranslate"><span class="pre">sym</span></code> or <code class="docutils literal notranslate"><span class="pre">dc</span></code> (or any combination of up to two of these services).</p></li>
<li><p><strong>Perform</strong> <code class="docutils literal notranslate"><span class="pre">qat_service</span> <span class="pre">shutdown</span></code> and <code class="docutils literal notranslate"><span class="pre">qat_service</span> <span class="pre">start</span></code>.</p></li>
</ol>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>For Out-of-Tree (OOT) PKE, the total CIR for all SLAs should equal 1000 to ensure proper rate limiting. For symmetric crypto and data compression services, the total CIR should equal the total capacity as returned by the <cite>sla_mgr</cite> tool.</p>
</div>
</section>
<section id="service-level-agreement-sla">
<h3>Service Level Agreement (SLA)<a class="headerlink" href="#service-level-agreement-sla" title="Permalink to this heading"></a></h3>
<p>Service Level Agreement enforcement allocates a specified amount of capacity for a specified service to a specified VF:
<em>max SLA enforced = (number of VFs) X (number of services)</em> where:</p>
<blockquote>
<div><ul class="simple">
<li><p>Number of VFs varies based on device type</p></li>
<li><p>Number of services = 2 (asymmetric or symmetric or compression)</p></li>
</ul>
</div></blockquote>
</section>
<section id="sla-units">
<h3>SLA Units<a class="headerlink" href="#sla-units" title="Permalink to this heading"></a></h3>
<p>SLA units are measured as follows:</p>
<ul class="simple">
<li><p>Symmetric Crypto - 1Mbps of throughput.</p></li>
<li><p>Asymmetric Crypto - 1 unit is equal to 0.1 percent of available utilization.</p></li>
<li><p>Compression - 1Mbps of throughput.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>In Gen4 devices, for Asymmetric Crypto services, SLA units are measured in terms of percentage of slice utilization. This metric is more accurate than operations/second or throughput/second because it directly reflects the hardware resources consumed by each user, independent of algorithm processing speed, providing a fair representation of resource usage.</p></li>
<li><p>Gen4 devices use a Hardware-assisted Rate limiting approach whereas legacy devices use a firmware-only Rate limiting approach.</p></li>
<li><p>For asymmetric service, SLAs shall be allocated at a granularity of 1 unit of device utilization percentage for RSA2K.</p></li>
<li><p>Below is a sample mapping table for the 5th Gen Intel® Xeon® Scalable Processer - MCC SKU platform that translates the SLA units to equivalent ops/sec.</p></li>
<li><p>Users can run tests with the required algorithm to determine the mapping for other SKUs with different performance. Gen4 asymmetric performance numbers can differ based on the SKU.</p></li>
</ol>
</div>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">Sample Mapping Table for 5th Gen Intel® Xeon® Scalable Processer - MCC SKU</span><a class="headerlink" href="#id3" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Unit</p></th>
<th class="head"><p>RSA2K decrypt with CRT (Ops/sec)</p></th>
<th class="head"><p>RSA4K decrypt with CRT (Ops/sec)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>60</p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>300</p></td>
<td><p>–</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>600</p></td>
<td><p>60</p></td>
</tr>
<tr class="row-odd"><td><p>50</p></td>
<td><p>3000</p></td>
<td><p>300</p></td>
</tr>
<tr class="row-even"><td><p>100</p></td>
<td><p>6000</p></td>
<td><p>600</p></td>
</tr>
<tr class="row-odd"><td><p>300</p></td>
<td><p>18000</p></td>
<td><p>1800</p></td>
</tr>
<tr class="row-even"><td><p>500</p></td>
<td><p>30000</p></td>
<td><p>3000</p></td>
</tr>
<tr class="row-odd"><td><p>750</p></td>
<td><p>45000</p></td>
<td><p>4500</p></td>
</tr>
<tr class="row-even"><td><p>1000</p></td>
<td><p>60000</p></td>
<td><p>6000</p></td>
</tr>
</tbody>
</table>
</section>
<section id="sla-manager-application">
<h3>SLA Manager Application<a class="headerlink" href="#sla-manager-application" title="Permalink to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">sla_mgr</span></code> tool is used to create, update, delete, list and get SLA capabilities.
The SLA Manager executable is available in <code class="docutils literal notranslate"><span class="pre">$ICP_ROOT/build/sla_mgr</span></code> after the package is built and installed using <code class="docutils literal notranslate"><span class="pre">./configure;</span> <span class="pre">make</span> <span class="pre">install</span></code> commands.</p>
<section id="sla-commands">
<h4>SLA Commands<a class="headerlink" href="#sla-commands" title="Permalink to this heading"></a></h4>
<table class="longtable colwidths-given docutils align-default" id="id4">
<caption><span class="caption-text">Rate Limiting SLA Commands</span><a class="headerlink" href="#id4" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Operation</strong></p></th>
<th class="head"><p><strong>Command</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p><strong>Rate Limiting V1 (Legacy)</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Create SLA</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./sla_mgr</span> <span class="pre">create</span> <span class="pre">&lt;vf_addr&gt;</span> <span class="pre">&lt;rate_in_sla_units&gt;</span> <span class="pre">&lt;service&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Update SLA</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./sla_mgr</span> <span class="pre">update</span> <span class="pre">&lt;pf_addr&gt;</span> <span class="pre">&lt;sla_id&gt;</span> <span class="pre">&lt;rate_in_sla_units&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p><strong>Rate Limiting V2</strong></p></td>
</tr>
<tr class="row-even"><td><p>Create SLA</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./sla_mgr</span> <span class="pre">create</span> <span class="pre">&lt;vf_addr&gt;</span> <span class="pre">&lt;cir&gt;</span> <span class="pre">&lt;pir&gt;</span> <span class="pre">&lt;service&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Update SLA</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./sla_mgr</span> <span class="pre">update</span> <span class="pre">&lt;pf_addr&gt;</span> <span class="pre">&lt;sla_id&gt;</span> <span class="pre">&lt;cir&gt;</span> <span class="pre">&lt;pir&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td colspan="2"><p><strong>For Legacy and Rate Limiting V2</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Delete SLA</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./sla_mgr</span> <span class="pre">delete</span> <span class="pre">&lt;pf_addr&gt;</span> <span class="pre">&lt;sla_id&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Delete all SLAs</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./sla_mgr</span> <span class="pre">delete_all</span> <span class="pre">&lt;pf_addr&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Query SLA capabilities</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./sla_mgr</span> <span class="pre">caps</span> <span class="pre">&lt;pf_addr&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Query list of SLAs</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./sla_mgr</span> <span class="pre">list</span> <span class="pre">&lt;pf_addr&gt;</span></code></p></td>
</tr>
</tbody>
</table>
<p>Options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pf_addr</span></code> - Physical address in <cite>domain:bus:device.function(xxxx:xx:xx.x)</cite> format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vf_addr</span></code> - Virtual address in <cite>domain:bus:device.function(xxxx:xx:xx.x)</cite> format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Service</span></code> - Asym(=0) or Sym(=1) or DC(=2).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rate_in_sla_units</span></code> - [ 0-MAX]. MAX is found by querying the capabilities.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cir/pir</span></code> - committed/peak information rate [0-MAX]. MAX is found by querying the capabilities.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sla_id</span></code> - Value returned by <code class="docutils literal notranslate"><span class="pre">create</span></code> command.</p></li>
</ul>
<p>In Legacy mode, to create/update SLA we use <cite>rate_in_sla_units</cite>. With Rate Limiting V2, we use <cite>cir/pir</cite>. These units are equal to:</p>
<ul class="simple">
<li><p>1 operation per second - for asymmetric service (Legacy) or 0.1 percent of available utilization (Rate Limiting V2).</p></li>
<li><p>1 Megabits per second - for symmetric service/compression service.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use Legacy Rate limiting <cite>sla_mgr</cite> application, user needs to configure with option <cite>–enable-legacy-sla-mgr</cite>.</p>
</div>
</section>
</section>
<section id="best-practices-for-sla-management">
<h3>Best Practices for SLA Management<a class="headerlink" href="#best-practices-for-sla-management" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Ensure all VFs are included in SLAs to prevent unregulated resource usage.</p></li>
<li><p>Regularly monitor performance and adjust CIR and PIR values as needed to maintain optimal throughput.</p></li>
</ul>
</section>
</section>
<section id="in-tree-rate-limiting">
<h2>In-tree Rate Limiting<a class="headerlink" href="#in-tree-rate-limiting" title="Permalink to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For additional details on Rate Limiting with the In-tree solution, refer to <a class="reference external" href="https://www.kernel.org/doc/Documentation/ABI/testing/sysfs-driver-qat_rl">sysfs-driver-qat_rl documentation.</a></p>
</div>
<p>Rate Limiting for the in-tree stack is configured per individual Physical Function (PF) using sysfs calls. Each PF has a directory structure that includes several files used to manage SLAs:</p>
<section id="directory-structure">
<h3>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this heading"></a></h3>
<p>The rate limiting attributes for each PF are located at:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/sys/bus/pci/devices/&lt;BDF&gt;/qat_rl/
</pre></div>
</div>
<p>The files included in this directory are:</p>
<ul class="simple">
<li><p><strong>cap_rem</strong>: Reports the remaining capability for a particular service/SLA. This is the remaining value that a new SLA can be set to or a current SLA can be increased with.</p></li>
<li><p><strong>cir</strong>: Committed Information Rate (CIR). The guaranteed rate of throughput that a VF can achieve under its SLA. The value is expressed in permille scale, i.e., 1000 refers to the maximum device throughput for a selected service.</p></li>
<li><p><strong>id</strong>: Used to retrieve a particular SLA and operate on it. Valid for update, rm, and get operations.</p></li>
<li><p><strong>pir</strong>: Peak Information Rate (PIR). The maximum rate that can be achieved by that particular SLA. An SLA can reach a value between CIR and PIR when the device is not fully utilized by requests from other users.</p></li>
<li><p><strong>rp</strong>: Configures the ring pairs associated with an SLA. The value is a 64-bit bit mask and is written/displayed in hex.</p></li>
<li><p><strong>sla_op</strong>: Used to perform operations on an SLA, such as add, update, rm, rm_all, and get.</p></li>
<li><p><strong>srv</strong>: Represents the service (sym, asym, dc) associated with an SLA.</p></li>
</ul>
</section>
<section id="id1">
<h3>Enabling Rate Limiting<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>To enable the Rate Limiting feature for the In-tree stack:</p>
<ol class="arabic simple">
<li><p><strong>Identify</strong> the device using the Bus-Device-Function (BDF) format, e.g., <cite>&lt;BDF&gt;</cite>.</p></li>
<li><p><strong>Configure</strong> the SLA using the sysfs attributes available for qat_4xxx devices.</p></li>
<li><p><strong>Ensure</strong> the total CIR for all VFs equals 1000 to ensure proper rate limiting.</p></li>
</ol>
</section>
<section id="id2">
<h3>SLA Units<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<p>For the In-tree stack, SLA units are measured as follows:</p>
<ul class="simple">
<li><p>All services (sym, asym, dc) - 1 unit is equal to 0.1 percent of available utilization.</p></li>
</ul>
</section>
<section id="example-setting-of-slas">
<h3>Example Setting of SLAs<a class="headerlink" href="#example-setting-of-slas" title="Permalink to this heading"></a></h3>
<p>This example demonstrates setting up SLAs for all VFs for a specified PF, focusing on symmetric and asymmetric crypto services. The RP value is shifted for each VF to allocate resources appropriately.</p>
<ol class="arabic">
<li><p><strong>Remove Existing SLAs</strong>: Clear any existing SLAs for the device.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;rm_all&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/sla_op
</pre></div>
</div>
</li>
<li><p><strong>Set SLAs for Symmetric Service</strong>:
For each VF, set the SLA parameters and add the SLA:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>vf<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">0</span>..15<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">cir_pir_value</span><span class="o">=</span><span class="m">62</span>
<span class="w">    </span><span class="nv">rp_value</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;0x%x&quot;</span><span class="w"> </span><span class="k">$((</span><span class="m">0xa</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">(</span><span class="nv">vf</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">4</span><span class="k">)))</span><span class="o">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$cir_pir_value</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/cir
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$cir_pir_value</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/pir
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;sym&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/srv
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$rp_value</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/rp
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;add&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/sla_op
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SLA added for BDF: 0000:6b:00.0, VF: </span><span class="nv">$vf</span><span class="s2">, Service: sym, RP: </span><span class="nv">$rp_value</span><span class="s2">, CIR/PIR: </span><span class="nv">$cir_pir_value</span><span class="s2">&quot;</span>
<span class="k">done</span>
</pre></div>
</div>
</li>
<li><p><strong>Set SLAs for Asymmetric Service</strong>:
Similarly, set the SLA parameters for the asymmetric service:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>vf<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">0</span>..15<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">cir_pir_value</span><span class="o">=</span><span class="m">62</span>
<span class="w">    </span><span class="nv">rp_value</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;0x%x&quot;</span><span class="w"> </span><span class="k">$((</span><span class="m">0x5</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">(</span><span class="nv">vf</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">4</span><span class="k">)))</span><span class="o">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$cir_pir_value</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/cir
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$cir_pir_value</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/pir
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;asym&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/srv
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$rp_value</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/rp
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;add&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000:6b:00.0/qat_rl/sla_op
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SLA added for BDF: 0000:6b:00.0, VF: </span><span class="nv">$vf</span><span class="s2">, Service: asym, RP: </span><span class="nv">$rp_value</span><span class="s2">, CIR/PIR: </span><span class="nv">$cir_pir_value</span><span class="s2">&quot;</span>
<span class="k">done</span>
</pre></div>
</div>
</li>
</ol>
<p>This example illustrates setting up rate limiting for one QAT endpoint, evenly distributing the PF capacity among 16 VFs for both symmetric and asymmetric services.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="infrastructure_device_telemetry.html" class="btn btn-neutral float-left" title="Telemetry" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="infrastructure_power_management.html" class="btn btn-neutral float-right" title="Power Management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Intel Corporation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>