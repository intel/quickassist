<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intel® QAT OpenSSL* Engine Installation &mdash; Intel® QuickAssist Technology  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/qat.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Intel® QAT OpenSSL* Engine Testing" href="testing.html" />
    <link rel="prev" title="The Intel® QAT OpenSSL* Engine" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Intel® QuickAssist Technology
          </a>
              <div class="version">
                Hardware Version 2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../qat_general/legal.html">Legal Notices &amp; Disclaimers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Intro/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Intro/terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RN/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GSG/2.X/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PG/index.html">Programmer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../VIRT/index.html">Virtualization Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PERF/index.html">Performance Optimization Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Application Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../QATzip/index.html">Intel<sup>®</sup> QATzip</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Intel<sup>®</sup> QAT OpenSSL* Engine</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">The Intel® QAT OpenSSL* Engine</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Intel® QAT OpenSSL* Engine Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-openssl">Install OpenSSL*</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-the-intel-qat-openssl-engine">Build the Intel® QAT OpenSSL* Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#copy-the-intel-qat-driver-config-files-for-hardware-acceleration-qat-hw">Copy the Intel® QAT Driver config files for Hardware Acceleration (QAT_HW)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="testing.html">Intel® QAT OpenSSL* Engine Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html">Intel® QAT OpenSSL* Engine Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="specificmessages.html">Intel® QAT OpenSSL* Engine Specific Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildoptions.html">Intel® QAT OpenSSL* Engine Build Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="specialfeatures.html">Intel® QAT OpenSSL* Engine Special Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="loadengines.html">Load/Initialize Engines with OpenSSL* Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Containers/index.html">Intel<sup>®</sup> QAT in Linux Containers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../qat_general/contact.html">Contact &amp; Support</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Intel® QuickAssist Technology</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Application Notes</a> &raquo;</li>
          <li><a href="index.html">Intel<sup>®</sup> QAT OpenSSL* Engine</a> &raquo;</li>
      <li>Intel® QAT OpenSSL* Engine Installation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="intel-qat-openssl-engine-installation">
<span id="qat-2-0-qatengine-installation"></span><h1>Intel® QAT OpenSSL* Engine Installation<a class="headerlink" href="#intel-qat-openssl-engine-installation" title="Permalink to this headline"></a></h1>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline"></a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure to install first the Intel® QuickAssist Technology Software. Refer to <a class="reference internal" href="../../GSG/GSG/2.X/installation.html#qat-2-0-gsg-installation"><span class="std std-ref">Intel QAT Software Installation</span></a> for details.</p>
</div>
<section id="hardware-acceleration-qat-hw">
<h3>Hardware Acceleration (QAT_HW)<a class="headerlink" href="#hardware-acceleration-qat-hw" title="Permalink to this headline"></a></h3>
<section id="contiguous-memory-driver">
<h4>Contiguous Memory Driver<a class="headerlink" href="#contiguous-memory-driver" title="Permalink to this headline"></a></h4>
<p>The Intel® QAT API requires many of the data structures (those that will be passed to the hardware) to be allocated in contiguous pinned memory
in order to support DMA operations. You must either supply your own contiguous memory driver and make changes to the engine to make use of it or
use one of the following drivers:</p>
<p><strong>User Space DMA-able Memory (USDM) Component</strong></p>
<p>The Intel® QAT driver - Hardware Version 1.7 comes with its own contiguous pinned memory driver that is compatible with the Intel® QAT OpenSSL* Engine.
The USDM component is of a higher quality than the <em>qat_contig_mem</em> driver provided within the Intel® QAT OpenSSL* Engine, and is the preferred option.
The USDM component is used by the Intel® QAT driver - Hardware Version 1.7 itself, and also has the following additional features:</p>
<blockquote>
<div><ul class="simple">
<li><p>Support for virtualization.</p></li>
<li><p>Support for configurable slab sizes.</p></li>
<li><p>Support for configurable secure freeing of memory (overwrite with zeros).</p></li>
<li><p>Support for configurable slab caching.</p></li>
<li><p>Support for newer kernels.</p></li>
</ul>
</div></blockquote>
<p>The USDM component is located within the Intel® QAT driver - Hardware Version 1.7 source code in the following subdirectory: <code class="docutils literal notranslate"><span class="pre">quickassist/utilities/libusdm_drv</span></code>.
As the USDM component is also used by the Intel® QAT driver - Hardware Version 1.7 driver itself it will have already been built when the driver was built.
It may also already be loaded as well, and you can check by running <code class="docutils literal notranslate"><span class="pre">lsmod</span></code> and looking for <code class="docutils literal notranslate"><span class="pre">usdm_drv</span></code> in the list. If not present it can be loaded as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">modprobe usdm_drv.ko</span>
</pre></div>
</div>
<p><strong>Contiguous Memory Driver</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step is not required if using the default USDM driver above.</p>
</div>
<p>The Intel® QAT OpenSSL* Engine comes with an example kernel space contiguous memory
driver that can be used to try out operation of the engine. It is considered to be an example only and is not written to be a production quality driver.
The use of the <em>qat_contig_mem</em> driver can be enabled using the configure option <code class="docutils literal notranslate"><span class="pre">--enable-qat_hw_contig_mem</span></code> that tells the build that the
Intel® QAT OpenSSL* Engine should be compiled to use the <em>qat_contig_mem</em> component instead of the USDM memory driver above.</p>
<p>To build/install the <em>qat_contig_mem</em> driver run these commands:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Building and loading the <em>qat_contig_mem</em> driver assumming that the Intel® QAT OpenSSL* Engine was cloned to its own location at the root of the drive: <code class="docutils literal notranslate"><span class="pre">/</span></code>.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /QAT_Engine/qat_contig_mem</span>
<span class="go">make</span>
<span class="go">make load</span>
<span class="go">make test</span>
</pre></div>
</div>
<p>The expected output from <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> should be something similar to the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">seg mapped to 0x7f9eedd6e000, virtualAddress in seg 0xffff880ac9c0c000,</span>
<span class="go">length 64</span>
<span class="go">Hello world!</span>
<span class="go">PASS Verify for QAT Contig Mem Test</span>
</pre></div>
</div>
</section>
</section>
<section id="software-acceleration-qat-sw">
<h3>Software Acceleration (QAT_SW)<a class="headerlink" href="#software-acceleration-qat-sw" title="Permalink to this headline"></a></h3>
<p>Verify <code class="docutils literal notranslate"><span class="pre">qat_sw</span></code> components are installed as described in  <a class="reference internal" href="introduction.html#qat-2-0-qatengine-qat-sw-requirements"><span class="std std-ref">Software Acceleration (QAT_SW) requirements</span></a>.</p>
</section>
</section>
<section id="install-openssl">
<h2>Install OpenSSL*<a class="headerlink" href="#install-openssl" title="Permalink to this headline"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step is not required if OpenSSL* 1.1.1 is already installed.</p>
</div>
<section id="build-openssl">
<h3>Build OpenSSL*<a class="headerlink" href="#build-openssl" title="Permalink to this headline"></a></h3>
<p>This step is not required if building the Intel® QAT OpenSSL* Engine against system prebuilt OpenSSL* 1.1.1. When using the prebuild system
OpenSSL library the engine library is installed in the system OpenSSL engines directory.</p>
<p>Clone OpenSSL* from Github* at the following location:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone https://github.com/openssl/openssl.git</span>
</pre></div>
</div>
<p>It is recommended to checkout and build against the OpenSSL* git tag specified in the <a class="reference internal" href="introduction.html#qat-2-0-qatengine-sw-requirements"><span class="std std-ref">Software Requirements</span></a> section.
OpenSSL* Version 1.1.1 and 3.0 are only supported.</p>
<p>Due to the nature of the Intel® QAT OpenSSL* Engine being a dynamic engine it can only be used with shared library builds of OpenSSL*.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The OpenSSL* 1.1.0 and 1.1.1 baselines build as a shared library by default now so there is no longer any need to specify the shared option when running <code class="docutils literal notranslate"><span class="pre">./config</span></code>.</p></li>
<li><p>It is not recommended to install the accelerated version of OpenSSL* as your default system library. If you do, you may find that acceleration is used unexpectedly by other applications on the system resulting in undesired/unsupported behaviour. The <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> can be used with the <code class="docutils literal notranslate"><span class="pre">./config</span></code> command to specify the location that <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> will copy files to. Please see the OpenSSL* <em>INSTALL</em> file for full details on usage of the <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> option.</p></li>
</ul>
</div>
<p>With OpenSSL* version 1.1.0 and on, binaries are installed in standard directories by default, and the addition of runpath directories is not done automatically.
If you wish to install OpenSSL* in a non-standard location (recommended), the runpath directories can be specified via the OpenSSL* <em>Configure</em> command,
which recognises the arguments <code class="docutils literal notranslate"><span class="pre">-rpath</span></code> and <code class="docutils literal notranslate"><span class="pre">-R</span></code> to support user-added runpaths. For convenience, a Makefile variable <code class="docutils literal notranslate"><span class="pre">LIBRPATH</span></code> has also been added
which is defined as the full path to a subdirectory of the installation directory. The subdirectory is named <code class="docutils literal notranslate"><span class="pre">lib</span></code> by default. If you do not wish
to use <code class="docutils literal notranslate"><span class="pre">LIBRPATH</span></code>, the runpath can be specified directly. The syntax for specifying a runpath is as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./config [options] -Wl,-rpath,\${LIBRPATH}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-rpath</span></code> can be replaced with <code class="docutils literal notranslate"><span class="pre">-R</span></code> for brevity. If you do not wish to use the built-in variable <code class="docutils literal notranslate"><span class="pre">LIBRPATH</span></code>, the syntax for
specifying a runpath of <code class="docutils literal notranslate"><span class="pre">/usr/local/ssl/lib</span></code> for example would be:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./config [options] -Wl,-rpath,/usr/local/ssl/lib</span>
</pre></div>
</div>
<p>Alternatively, you can specify the runpath by adding it to the environment variable <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> via the command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:`RPATH`</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">RPATH</span></code> is the full path(s) to the shared libraries. This is not the preferred method though. An example build would be:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following example is assuming:</p>
<blockquote>
<div><ul class="simple">
<li><p>The OpenSSL* source was cloned from GitHub* to its own location at the root of the drive: <code class="docutils literal notranslate"><span class="pre">/</span></code>.</p></li>
<li><p>You want OpenSSL* to be installed to <code class="docutils literal notranslate"><span class="pre">/usr/local/ssl</span></code>.</p></li>
</ul>
</div></blockquote>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /openssl</span>
<span class="go">./config --prefix=/usr/local/ssl -Wl,-rpath,\${LIBRPATH}</span>
<span class="go">make depend (if recommended by the OpenSSL* build system)</span>
<span class="go">make</span>
<span class="go">make install</span>
</pre></div>
</div>
<p>As the Intel® QAT OpenSSL* Engine will be built as a dynamic engine it is important to tell OpenSSL* where to find the dynamic engines at runtime.
This is achieved by exporting the following environment variable (assuming the example paths above):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export OPENSSL_ENGINES=/usr/local/ssl/lib/engines-1.1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This variable will need to be present in the environment whenever the engine is used.</p>
</div>
<p>Load/Initialize Engine using the OpenSSL* config file. Details are described in <a class="reference internal" href="loadengines.html#qat-2-0-qatengine-load-engines"><span class="std std-ref">Load/Initialize Engines with OpenSSL* Configuration File</span></a>.</p>
<p>Further information on building OpenSSL* can be found in the <em>INSTALL</em> file distributed with the OpenSSL* source code or on the official
OpenSSL* Wiki in the <a class="reference external" href="https://wiki.openssl.org/index.php/Compilation_and_Installation">Compilation and Installation</a> section.</p>
</section>
</section>
<section id="build-the-intel-qat-openssl-engine">
<span id="qat-2-0-qatengine-build-qat-engine"></span><h2>Build the Intel® QAT OpenSSL* Engine<a class="headerlink" href="#build-the-intel-qat-openssl-engine" title="Permalink to this headline"></a></h2>
<p>Clone the GitHub* repository containing the Intel® QAT OpenSSL* Engine:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone https://github.com/intel/QAT_Engine.git</span>
</pre></div>
</div>
<p>When building it, it is possible to specify command line options that can be used to turn engine functionality on and off.
The complete list of these options is available in <a class="reference internal" href="buildoptions.html#qat-2-0-qatengine-build-options"><span class="std std-ref">Intel® QAT OpenSSL* Engine Build Options</span></a>.</p>
<p>The prerequisite to run <em>autogen.sh</em> is to have autotools (<em>autoconf</em>, <em>automake</em>, <em>libtool</em> and <em>pkg-config</em>) installed in the system.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /QAT_Engine</span>
<span class="go">./autogen.sh</span>
</pre></div>
</div>
<p><em>./autogen.sh</em> will regenerate autoconf tools files.</p>
<section id="example-builds">
<h3>Example Builds<a class="headerlink" href="#example-builds" title="Permalink to this headline"></a></h3>
<p>Here are a few example builds that demonstrate how the Intel® QAT OpenSSL* Engine can be configured to use <code class="docutils literal notranslate"><span class="pre">qat_hw</span></code> and/or <code class="docutils literal notranslate"><span class="pre">qat_sw</span></code>.</p>
<p><strong>Example 1: qat_hw target with OpenSSL* 1.1.1 built from source</strong></p>
<p>The following example is assuming:</p>
<blockquote>
<div><ul class="simple">
<li><p>The Intel® QAT OpenSSL* Engine was cloned to its own location at the root of the drive: <code class="docutils literal notranslate"><span class="pre">/</span></code>.</p></li>
<li><p>The Intel® QAT Driver was unpacked within <code class="docutils literal notranslate"><span class="pre">/QAT</span></code> and using the USDM component.</p></li>
<li><p>OpenSSL* 1.1.1 built from source is being used and installed to <code class="docutils literal notranslate"><span class="pre">/usr/local/ssl</span></code>.</p></li>
</ul>
</div></blockquote>
<p>To build and install the Intel® QAT OpenSSL* Engine:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /QAT_Engine</span>
<span class="go">./configure --with-qat_hw_dir=/QAT --with-openssl_install_dir=/usr/local/ssl</span>
<span class="go">make</span>
<span class="go">make install</span>
</pre></div>
</div>
<p>In the above example this will create the file <code class="docutils literal notranslate"><span class="pre">qatengine.so</span></code> and copy it to <code class="docutils literal notranslate"><span class="pre">/usr/local/ssl/lib/engines-1.1</span></code>.</p>
<p><strong>Example 2: qat_hw target with Prebuilt OpenSSL 1.1.1</strong></p>
<p>The following example is assuming:</p>
<blockquote>
<div><ul class="simple">
<li><p>The Intel® QAT OpenSSL* Engine was cloned to its own location at the root of the drive: <code class="docutils literal notranslate"><span class="pre">/</span></code>.</p></li>
<li><p>The Intel® QAT Driver was unpacked within <code class="docutils literal notranslate"><span class="pre">/QAT</span></code> and using the USDM component.</p></li>
<li><p>Prebuilt OpenSSL* (both library and devel RPM packages) are installed in the system and the OpenSSL* version is in the 1.1.1 series.</p></li>
</ul>
</div></blockquote>
<p>To build and install the Intel® QAT OpenSSL* Engine:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /QAT_Engine</span>
<span class="go">./configure --with-qat_hw_dir=/QAT</span>
<span class="go">make</span>
<span class="go">make install</span>
</pre></div>
</div>
<p>In the above example this will create the file <code class="docutils literal notranslate"><span class="pre">qatengine.so</span></code> and copy it to the engines directory of the system which can be checked using <code class="docutils literal notranslate"><span class="pre">pkg-config</span> <span class="pre">--variable=enginesdir</span> <span class="pre">libcrypto</span></code>.</p>
<p>If OpenSSL* version in the system can not be updated to 1.1.1 series, then the engine needs to be built from source using the
option <code class="docutils literal notranslate"><span class="pre">--with-openssl_install_dir</span></code>. An additional option <code class="docutils literal notranslate"><span class="pre">--with-openssl_dir</span></code> pointing to the top directory of the OpenSSL* source needs to be provided
for regenerating err files if there are any new error messages added/deleted in the source code.</p>
<p><strong>Example 3: qat_hw + qat_sw target with Prebuilt OpenSSL 1.1.1</strong></p>
<p>The following example is assuming:</p>
<blockquote>
<div><ul class="simple">
<li><p>The Intel® QAT OpenSSL* Engine was cloned to its own location at the root of the drive: <code class="docutils literal notranslate"><span class="pre">/</span></code>.</p></li>
<li><p>The Intel® QAT Driver was unpacked within <code class="docutils literal notranslate"><span class="pre">/QAT</span></code> and using the USDM component.</p></li>
<li><p>Intel® Multi-Buffer Crypto for IPsec Library was installed to the default path.</p></li>
<li><p>OpenSSL* 1.1.1 built from source is being used and installed to <code class="docutils literal notranslate"><span class="pre">/usr/local/ssl</span></code>.</p></li>
</ul>
</div></blockquote>
<p>To build and install the Intel® QAT OpenSSL* Engine:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /QAT_Engine</span>
<span class="go">./configure --with-qat_hw_dir=/QAT --enable-qat_sw --with-openssl_install_dir=/usr/local/ssl</span>
<span class="go">make</span>
<span class="go">make install</span>
</pre></div>
</div>
<p>In the above example this will create the file <code class="docutils literal notranslate"><span class="pre">qatengine.so</span></code> and copy it to <code class="docutils literal notranslate"><span class="pre">/usr/local/ssl/lib/engines-1.1</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>AES-GCM operations are handled by <code class="docutils literal notranslate"><span class="pre">qat_sw</span></code>. Other cryptographic operations are handled by <code class="docutils literal notranslate"><span class="pre">qat_hw</span></code>.</p>
</div>
<p><strong>Example 4: qat_sw target with Prebuilt OpenSSL 1.1.1</strong></p>
<p>The following example is assuming:</p>
<blockquote>
<div><ul class="simple">
<li><p>The Intel® QAT OpenSSL* Engine was cloned to its own location at the root of the drive: <code class="docutils literal notranslate"><span class="pre">/</span></code>.</p></li>
<li><p>The Intel® Crypto Multi-buffer library was installed to the default path <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code>.</p></li>
<li><p>The Intel® Multi-Buffer crypto for IPsec Library was installed to its default path <code class="docutils literal notranslate"><span class="pre">/usr/</span></code> (optional if QAT_SW AES-GCM support is not needed).</p></li>
<li><p>Prebuilt OpenSSL* 1.1.1 from the system is used.</p></li>
</ul>
</div></blockquote>
<p>To build and install the Intel® QAT OpenSSL* Engine with QAT_SW support:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /QAT_Engine</span>
<span class="go">./configure --enable-qat_sw</span>
<span class="go">make</span>
<span class="go">make install</span>
</pre></div>
</div>
<p>In the above example, <code class="docutils literal notranslate"><span class="pre">--disable-qat_hw</span></code> needs to be provided if the system has qatlib installed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">--enable-qat_sw</span></code> checks <em>crypto_mb</em> and <em>IPSec_MB</em> libraries in its respective default path or in the path provided in the config flag <code class="docutils literal notranslate"><span class="pre">--with-qat_sw_install_dir</span></code>. If any of the libraries is not installed then their corresponding algorithm support is disabled (<em>cryto_mb</em> library for PKE algorithms and <em>IPSec_mb</em> library for AES-GCM).</p>
</div>
</section>
</section>
<section id="copy-the-intel-qat-driver-config-files-for-hardware-acceleration-qat-hw">
<h2>Copy the Intel® QAT Driver config files for Hardware Acceleration (QAT_HW)<a class="headerlink" href="#copy-the-intel-qat-driver-config-files-for-hardware-acceleration-qat-hw" title="Permalink to this headline"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step is not required for <code class="docutils literal notranslate"><span class="pre">qat_sw</span></code> target.</p>
</div>
<p>The Intel® QAT OpenSSL* Engine includes example conf files to use with the Intel® QAT driver. The Intel® QAT OpenSSL* Engine will not function with the default Intel® QAT driver
conf file because the default configuration does not contain a <code class="docutils literal notranslate"><span class="pre">[SHIM]</span></code> section which the Intel® QAT OpenSSL* Engine requires by default. The default section name in the QAT OpenSSL* Engine can
be modified if required by either using the engine control command <code class="docutils literal notranslate"><span class="pre">SET_CONFIGURATION_SECTION_NAME</span></code> or by setting the environment variable <code class="docutils literal notranslate"><span class="pre">QAT_SECTION_NAME</span></code>. The conf files
are located at: <code class="docutils literal notranslate"><span class="pre">/path/to/qat_engine/qat/config</span></code></p>
<p>The files are grouped by acceleration device (<em>dh895xcc</em> or <em>c6xx</em> or <em>c3xxx</em>). Choose the files appropriate to your acceleration device only.</p>
<p>The files are also split into <em>multi_process_optimized</em> and <em>multi_thread_optimized</em>.</p>
<blockquote>
<div><ul class="simple">
<li><p>If your application runs one (or very few) processes, but has multiple threads in each process, each accessing the acceleration device, then you should pick the <em>multi_thread_optimized</em> config files. An example of this is a webserver that creates a new thread for each incoming connection.</p></li>
<li><p>If your application scales by creating new processes, then you should pick the <em>multi_process_optimized</em> config files. An example of this is an event driven application that runs as a single thread in an event loop. In this type of application it is usual for the application to create at least one new process for each cpu core you want to utilize.</p></li>
</ul>
</div></blockquote>
<p>There are also similar config files for if you are using the event driven polling feature of the Intel® QAT driver contained in
<em>multi_thread_event-driven_optimized</em> and <em>multi_process_event-driven_optimized</em> respectively. Event driven config files are only
supported in Linux. Once you have decided which config file you should use, or created your own you should follow the procedure below to install it:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>Stop</strong> the acceleration driver as decribed in <a class="reference internal" href="../../GSG/GSG/2.X/installation.html#qat-2-0-gsg-start-stop-software"><span class="std std-ref">Starting/Stopping the Acceleration Software</span></a> section of the Getting Started Guide.</p></li>
<li><p><strong>Copy</strong> the appropriate <code class="docutils literal notranslate"><span class="pre">.conf</span></code> file to <code class="docutils literal notranslate"><span class="pre">/etc</span></code>.</p></li>
<li><p><strong>Start</strong> the acceleration driver as decribed in <a class="reference internal" href="../../GSG/GSG/2.X/installation.html#qat-2-0-gsg-start-stop-software"><span class="std std-ref">Starting/Stopping the Acceleration Software</span></a> section of the Getting Started Guide.</p></li>
</ol>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introduction.html" class="btn btn-neutral float-left" title="The Intel® QAT OpenSSL* Engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="testing.html" class="btn btn-neutral float-right" title="Intel® QAT OpenSSL* Engine Testing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Intel Corporation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>